<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ± ì ì‹¬ íˆ¬í‘œ - ë¯¸ë¦¬ë³´ê¸°</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 16px; }
    body {
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f7fa;
      color: #1a1a2e;
      min-height: 100vh;
    }

    /* ===== ë¯¸ë¦¬ë³´ê¸° ì»¨íŠ¸ë¡¤ ë°” ===== */
    .preview-bar {
      background: #263238;
      color: #fff;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 0.85rem;
      position: sticky;
      top: 0;
      z-index: 500;
    }
    .preview-bar strong { color: #80cbc4; margin-right: 4px; }
    .phase-btn {
      padding: 5px 12px;
      border: 1px solid #546e7a;
      border-radius: 6px;
      background: transparent;
      color: #cfd8dc;
      cursor: pointer;
      font-size: 0.8rem;
      font-family: inherit;
      transition: all 0.15s;
    }
    .phase-btn:hover { background: #37474f; }
    .phase-btn.active { background: #1976d2; border-color: #1976d2; color: #fff; }
    .preview-note { color: #78909c; font-size: 0.78rem; margin-left: auto; }

    /* ===== Layout ===== */
    .app { max-width: 720px; margin: 0 auto; padding: 16px; }

    /* ===== Header ===== */
    .header {
      background: linear-gradient(135deg, #1976d2, #1565c0);
      color: #fff;
      border-radius: 16px;
      padding: 20px 24px;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .header-title { font-size: 1.5rem; font-weight: 700; letter-spacing: -0.5px; }
    .header-date  { font-size: 0.9rem; opacity: 0.85; }
    .header-refresh { font-size: 0.78rem; opacity: 0.7; }

    /* ===== Phase Badge ===== */
    .phase-bar-ui {
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      font-size: 0.95rem;
    }
    .phase-bar-ui.before_start { background: #e3f2fd; color: #0d47a1; }
    .phase-bar-ui.vote_active  { background: #e8f5e9; color: #1b5e20; }
    .phase-bar-ui.menu_active  { background: #fff3e0; color: #bf360c; }
    .phase-bar-ui.all_locked   { background: #f3e5f5; color: #4a148c; }
    .phase-dot {
      width: 10px; height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .vote_active  .phase-dot { background: #43a047; animation: blink 1.2s ease-in-out infinite; }
    .menu_active  .phase-dot { background: #ff7043; animation: blink 1.2s ease-in-out infinite; }
    .before_start .phase-dot { background: #90caf9; }
    .all_locked   .phase-dot { background: #ce93d8; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

    /* ===== Cards ===== */
    .card {
      background: #fff;
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }
    .card-title {
      font-size: 1rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* ===== ë“í‘œ í˜„í™© ===== */
    .vote-bars { display: flex; flex-direction: column; gap: 10px; }
    .vote-bar-row { display: flex; align-items: center; gap: 10px; }
    .vote-bar-label {
      width: 110px;
      font-size: 0.88rem;
      font-weight: 600;
      flex-shrink: 0;
      text-align: right;
      color: #444;
    }
    .vote-bar-label.winner { color: #2e7d32; }
    .vote-bar-track {
      flex: 1;
      background: #eee;
      border-radius: 6px;
      height: 22px;
      overflow: hidden;
    }
    .vote-bar-fill {
      height: 100%;
      background: #90caf9;
      border-radius: 6px;
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      padding-left: 8px;
      font-size: 0.78rem;
      font-weight: 700;
      color: #1a237e;
    }
    .vote-bar-fill.winner { background: #a5d6a7; color: #1b5e20; }
    .vote-bar-count { width: 30px; text-align: right; font-size: 0.88rem; font-weight: 700; color: #555; }

    /* ===== ì°¸ì—¬ í˜„í™© ===== */
    .progress-summary { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; font-size: 0.9rem; }
    .progress-track { flex: 1; height: 10px; background: #eee; border-radius: 5px; overflow: hidden; }
    .progress-fill { height: 100%; background: #42a5f5; border-radius: 5px; transition: width 0.5s ease; }
    .non-voters { font-size: 0.82rem; color: #e53935; margin-top: 6px; padding: 6px 10px; background: #ffebee; border-radius: 8px; line-height: 1.5; }

    /* ===== íˆ¬í‘œ í¼ ===== */
    .select-person {
      width: 100%;
      padding: 10px 14px;
      border: 2px solid #90caf9;
      border-radius: 10px;
      font-size: 1rem;
      font-family: inherit;
      color: #1a1a2e;
      background: #fff;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%231976d2' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 36px;
    }
    .select-person:focus { outline: none; border-color: #1976d2; }
    .vote-form { margin-top: 16px; }
    .form-section { margin-bottom: 18px; }
    .form-label { font-size: 0.82rem; font-weight: 700; color: #555; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; display: block; }

    .restaurant-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px; }
    .rest-chip {
      border: 2px solid #ccc;
      border-radius: 10px;
      padding: 10px 12px;
      cursor: pointer;
      user-select: none;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      background: #fafafa;
    }
    .rest-chip:hover { border-color: #1976d2; background: #e3f2fd; }
    .rest-chip.checked { border-color: #1976d2; background: #e3f2fd; color: #0d47a1; font-weight: 700; }
    .rest-chip.disabled { opacity: 0.45; cursor: not-allowed; pointer-events: none; }
    .chip-check {
      width: 18px; height: 18px;
      border: 2px solid #ccc;
      border-radius: 4px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      font-size: 12px;
    }
    .rest-chip.checked .chip-check { background: #1976d2; border-color: #1976d2; color: #fff; }

    .opt-out-btn {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 16px;
      border: 2px solid #ccc;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      font-size: 0.9rem; font-weight: 600;
      background: #fafafa;
      transition: all 0.15s;
      width: fit-content;
    }
    .opt-out-btn:hover { border-color: #ef5350; background: #ffebee; }
    .opt-out-btn.checked { border-color: #ef5350; background: #ffebee; color: #b71c1c; }
    .opt-out-btn.checked .chip-check { background: #ef5350; border-color: #ef5350; color: #fff; }

    .menu-inputs { display: flex; flex-direction: column; gap: 10px; }
    .input-row { display: flex; gap: 8px; }
    .input-field {
      flex: 1;
      padding: 10px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
      transition: border-color 0.2s;
    }
    .input-field:focus { outline: none; border-color: #1976d2; }
    .input-field.small { flex: 0 0 110px; }
    .input-field:disabled { background: #f5f5f5; color: #999; }

    .btn { padding: 12px 24px; border: none; border-radius: 10px; font-size: 0.95rem; font-weight: 700; font-family: inherit; cursor: pointer; transition: all 0.15s; display: inline-flex; align-items: center; gap: 6px; }
    .btn-primary { background: #1976d2; color: #fff; }
    .btn-primary:hover { background: #1565c0; }
    .btn-primary:disabled { background: #bbb; cursor: not-allowed; }
    .btn-menu { background: #ef6c00; color: #fff; }
    .btn-menu:hover { background: #e65100; }
    .btn-menu:disabled { background: #bbb; cursor: not-allowed; }
    .btn-sm { padding: 7px 14px; font-size: 0.82rem; }
    .action-row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }

    /* ===== ì „ì²´ í˜„í™© í…Œì´ë¸” ===== */
    .people-table-wrap { overflow-x: auto; }
    .people-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
    .people-table th, .people-table td { padding: 8px 10px; text-align: center; border-bottom: 1px solid #eee; }
    .people-table th { background: #f0f4f8; font-weight: 700; font-size: 0.78rem; color: #555; }
    .people-table td:first-child { text-align: left; font-weight: 600; }
    .people-table tr:last-child td { border-bottom: none; }
    .people-table tr:hover td { background: #f9f9f9; }
    .check-mark { color: #43a047; font-size: 1rem; }
    .opt-out-mark { color: #ef5350; font-size: 0.8rem; font-weight: 700; }

    /* ===== í† ìŠ¤íŠ¸ ===== */
    .toast-container { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; flex-direction: column; gap: 8px; pointer-events: none; align-items: center; }
    .toast { padding: 12px 20px; border-radius: 10px; font-size: 0.9rem; font-weight: 600; color: #fff; box-shadow: 0 4px 16px rgba(0,0,0,0.2); animation: slideUp 0.3s ease, fadeOut 0.4s ease 2.6s forwards; max-width: 340px; text-align: center; }
    .toast.success { background: #2e7d32; }
    .toast.error   { background: #c62828; }
    .toast.info    { background: #1565c0; }
    @keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
    @keyframes fadeOut { from { opacity:1; } to { opacity:0; } }

    @media (max-width: 480px) {
      .restaurant-grid { grid-template-columns: repeat(2, 1fr); }
      .input-row { flex-direction: column; }
      .input-field.small { flex: 1; }
    }
  </style>
</head>
<body>

<!-- ë¯¸ë¦¬ë³´ê¸° ì»¨íŠ¸ë¡¤ ë°” -->
<div class="preview-bar">
  <strong>ğŸ” ë¯¸ë¦¬ë³´ê¸°</strong>
  <button class="phase-btn" onclick="setPhase('before_start')">ì‹œì‘ ì „</button>
  <button class="phase-btn active" onclick="setPhase('vote_active')">íˆ¬í‘œ ì¤‘</button>
  <button class="phase-btn" onclick="setPhase('menu_active')">ë©”ë‰´ ì…ë ¥</button>
  <button class="phase-btn" onclick="setPhase('all_locked')">ë§ˆê°</button>
  <span class="preview-note">ì‹¤ì œ ë°ì´í„°ì™€ ì—°ê²°ë˜ì§€ ì•Šì€ UI ë¯¸ë¦¬ë³´ê¸°ì…ë‹ˆë‹¤</span>
</div>

<!-- í† ìŠ¤íŠ¸ -->
<div class="toast-container" id="toastContainer"></div>

<div class="app">

  <!-- í—¤ë” -->
  <div class="header">
    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
      <span class="header-title">ğŸ± ì ì‹¬ íˆ¬í‘œ</span>
    </div>
    <div class="header-date" id="headerDate">2026-02-25 ì ì‹¬ íˆ¬í‘œ</div>
    <div class="header-refresh">ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ</div>
  </div>

  <!-- ë‹¨ê³„ í‘œì‹œ -->
  <div class="phase-bar-ui vote_active" id="phaseBar">
    <div class="phase-dot"></div>
    <span id="phaseLabel">ì‹ë‹¹ íˆ¬í‘œ ì§„í–‰ ì¤‘ (~11:00)</span>
  </div>

  <!-- ë“í‘œ í˜„í™© -->
  <div class="card">
    <div class="card-title">ğŸ“Š ì‹¤ì‹œê°„ ë“í‘œ í˜„í™©</div>
    <div class="vote-bars" id="voteBars"></div>
  </div>

  <!-- ì°¸ì—¬ í˜„í™© -->
  <div class="card">
    <div class="card-title">ğŸ‘¥ ì°¸ì—¬ í˜„í™©</div>
    <div class="progress-summary">
      <span id="progressText" style="font-weight:700; min-width:80px;">6 / 8</span>
      <div class="progress-track">
        <div class="progress-fill" id="progressFill" style="width:75%"></div>
      </div>
      <span id="progressPct" style="font-size:0.85rem; color:#666;">75%</span>
    </div>
    <div class="non-voters" id="nonVoters">â° ì•„ì§ ë¯¸íˆ¬í‘œ: ê¹€ë¯¼ì§€, í•œìŠ¹ì¬</div>
  </div>

  <!-- ë‚´ íˆ¬í‘œ -->
  <div class="card">
    <div class="card-title">âœ‹ ë‚´ íˆ¬í‘œ</div>

    <select class="select-person" id="personSelect" onchange="onPersonChange()">
      <option value="">-- ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš” --</option>
      <option value="ê¹€ë³‘ì„">ê¹€ë³‘ì„ âœ“</option>
      <option value="ì´ì›ì¬">ì´ì›ì¬ âœ“</option>
      <option value="ì„ì¤€ìˆ˜">ì„ì¤€ìˆ˜ âœ“</option>
      <option value="í™©ì§€ëª…">í™©ì§€ëª… âœ“</option>
      <option value="ê¹€ì„¸í™˜">ê¹€ì„¸í™˜ âœ“</option>
      <option value="ì´ë²”ì‹ ">ì´ë²”ì‹  âœ“</option>
      <option value="ê¹€ë¯¼ì§€">ê¹€ë¯¼ì§€</option>
      <option value="í•œìŠ¹ì¬">í•œìŠ¹ì¬</option>
    </select>

    <div class="vote-form" id="voteForm" style="display:none">
      <div class="form-section" id="voteSection">
        <span class="form-label">ì‹ë‹¹ ì„ íƒ (ìµœëŒ€ 3ê°œ)</span>
        <div class="restaurant-grid" id="restaurantGrid"></div>
        <div style="margin-top:12px;">
          <label class="opt-out-btn" id="optOutBtn" onclick="toggleOptOut()">
            <div class="chip-check" id="optOutChipCheck">âœ—</div>
            ì‹ì‚¬X (ì˜¤ëŠ˜ ë¶ˆì°¸)
          </label>
        </div>
        <div class="action-row">
          <button class="btn btn-primary" id="saveVoteBtn" onclick="fakeAction('íˆ¬í‘œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!')">íˆ¬í‘œ ì €ì¥</button>
        </div>
      </div>

      <div class="form-section" style="margin-top:18px; padding-top:18px; border-top:1px solid #eee;">
        <span class="form-label">ë©”ë‰´ ì…ë ¥</span>
        <div class="menu-inputs">
          <input class="input-field" type="text" id="menuName" placeholder="ë©”ë‰´ëª… (ì˜ˆ: ê¹€ì¹˜ì°Œê°œ)" />
          <div class="input-row">
            <input class="input-field small" type="number" id="menuPrice" placeholder="ê°€ê²© (ì›)" />
            <input class="input-field" type="text" id="menuNote" placeholder="ë¹„ê³  (ì˜ˆ: í¬ì¥, ì¹´ë“œê²°ì œ ê°€ëŠ¥)" />
          </div>
        </div>
        <div class="action-row">
          <button class="btn btn-menu" id="saveMenuBtn" onclick="fakeAction('ë©”ë‰´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!')">ë©”ë‰´ ì €ì¥</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì „ì²´ í˜„í™© í…Œì´ë¸” -->
  <div class="card">
    <div class="card-title">ğŸ“‹ ì „ì²´ í˜„í™©</div>
    <div class="people-table-wrap">
      <table class="people-table">
        <thead>
          <tr>
            <th>ì´ë¦„</th>
            <th>ëŒ€ìˆ˜ì‹ë‹¹</th>
            <th>160ë„</th>
            <th>í•œì˜¥ì§‘ê¹€ì¹˜ì°œ</th>
            <th>ì²œê¶</th>
            <th>ë‘ë¦¬ìˆœëŒ€êµ­</th>
            <th>ì‹ì‚¬X</th>
            <th>ë©”ë‰´</th>
          </tr>
        </thead>
        <tbody id="peopleTableBody"></tbody>
      </table>
    </div>
  </div>

  <div style="text-align:center; font-size:0.75rem; color:#bbb; margin-top:8px; margin-bottom:24px;">
    ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ Â· ì‹¤ì œ ë°ì´í„°ëŠ” ì—°ê²°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
  </div>
</div>

<script>
// ===== ëª©ì—… ë°ì´í„° =====
const RESTAURANTS = ['ëŒ€ìˆ˜ì‹ë‹¹', '160ë„', 'í•œì˜¥ì§‘ê¹€ì¹˜ì°œ', 'ì²œê¶', 'ë‘ë¦¬ìˆœëŒ€êµ­'];

const MOCK_PEOPLE = [
  { name: 'ê¹€ë³‘ì„', votes: ['ëŒ€ìˆ˜ì‹ë‹¹', '160ë„'], optOut: false, hasVoted: true,
    menu: { name: 'ì œìœ¡ë³¶ìŒ', price: 8000, note: '' } },
  { name: 'ì´ì›ì¬', votes: ['í•œì˜¥ì§‘ê¹€ì¹˜ì°œ'], optOut: false, hasVoted: true,
    menu: { name: '', price: null, note: '' } },
  { name: 'ì„ì¤€ìˆ˜', votes: ['160ë„', 'ì²œê¶'], optOut: false, hasVoted: true,
    menu: { name: 'ëˆê¹ŒìŠ¤', price: 9000, note: 'í¬ì¥' } },
  { name: 'í™©ì§€ëª…', votes: ['ì²œê¶'], optOut: false, hasVoted: true,
    menu: { name: '', price: null, note: '' } },
  { name: 'ê¹€ì„¸í™˜', votes: ['ëŒ€ìˆ˜ì‹ë‹¹'], optOut: false, hasVoted: true,
    menu: { name: 'ëœì¥ì°Œê°œ', price: 7000, note: '' } },
  { name: 'ì´ë²”ì‹ ', votes: ['160ë„', 'ì²œê¶'], optOut: false, hasVoted: true,
    menu: { name: '', price: null, note: '' } },
  { name: 'ê¹€ë¯¼ì§€', votes: [], optOut: false, hasVoted: false,
    menu: { name: '', price: null, note: '' } },
  { name: 'í•œìŠ¹ì¬', votes: [], optOut: false, hasVoted: false,
    menu: { name: '', price: null, note: '' } },
];

const PHASE_CONFIG = {
  before_start: { label: 'íˆ¬í‘œ ì‹œì‘ ì „ (10:00 ì´í›„ íˆ¬í‘œ ê°€ëŠ¥)', voteDisabled: true,  menuDisabled: true  },
  vote_active:  { label: 'ì‹ë‹¹ íˆ¬í‘œ ì§„í–‰ ì¤‘ (~11:00)',           voteDisabled: false, menuDisabled: false },
  menu_active:  { label: 'ë©”ë‰´ ì…ë ¥ ì§„í–‰ ì¤‘ (~11:20)',           voteDisabled: true,  menuDisabled: false },
  all_locked:   { label: 'ì˜¤ëŠ˜ íˆ¬í‘œ ë§ˆê°',                       voteDisabled: true,  menuDisabled: true  },
};

let currentPhase = 'vote_active';
let myVotes = [];
let myOptOut = false;

// ===== ì´ˆê¸°í™” =====
document.addEventListener('DOMContentLoaded', () => {
  renderAll();
});

function setPhase(phase) {
  currentPhase = phase;
  document.querySelectorAll('.phase-btn').forEach(b => {
    b.classList.toggle('active', b.textContent.trim() === {
      before_start: 'ì‹œì‘ ì „', vote_active: 'íˆ¬í‘œ ì¤‘',
      menu_active: 'ë©”ë‰´ ì…ë ¥', all_locked: 'ë§ˆê°'
    }[phase]);
  });
  renderAll();
}

function renderAll() {
  const cfg = PHASE_CONFIG[currentPhase];

  // Phase ë°°ì§€
  const bar = document.getElementById('phaseBar');
  bar.className = 'phase-bar-ui ' + currentPhase;
  document.getElementById('phaseLabel').textContent = cfg.label;

  // ë“í‘œ í˜„í™©
  const counts = RESTAURANTS.map(r =>
    MOCK_PEOPLE.filter(p => p.votes.includes(r)).length
  );
  const maxCount = Math.max(...counts, 1);
  const minRankCount = Math.max(...counts);
  document.getElementById('voteBars').innerHTML = RESTAURANTS.map((r, i) => {
    const pct   = Math.round((counts[i] / maxCount) * 100);
    const isWin = counts[i] === minRankCount && counts[i] > 0;
    return `
      <div class="vote-bar-row">
        <div class="vote-bar-label${isWin ? ' winner' : ''}">${isWin ? 'ğŸ† ' : ''}${r}</div>
        <div class="vote-bar-track">
          <div class="vote-bar-fill${isWin ? ' winner' : ''}" style="width:${pct}%">
            ${counts[i] > 0 ? counts[i] + 'í‘œ' : ''}
          </div>
        </div>
        <div class="vote-bar-count">${counts[i]}</div>
      </div>`;
  }).join('');

  // ì°¸ì—¬ í˜„í™©
  const voted = MOCK_PEOPLE.filter(p => p.hasVoted).length;
  const total = MOCK_PEOPLE.length;
  const pct   = Math.round(voted / total * 100);
  document.getElementById('progressText').textContent = `${voted} / ${total}`;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressPct').textContent = pct + '%';
  const nonVoters = MOCK_PEOPLE.filter(p => !p.hasVoted).map(p => p.name);
  const nvEl = document.getElementById('nonVoters');
  if (nonVoters.length > 0 && currentPhase !== 'all_locked') {
    nvEl.style.display = '';
    nvEl.textContent = 'â° ì•„ì§ ë¯¸íˆ¬í‘œ: ' + nonVoters.join(', ');
  } else {
    nvEl.style.display = 'none';
  }

  // ë‚´ íˆ¬í‘œ í¼ ê°±ì‹ 
  const name = document.getElementById('personSelect').value;
  if (name) renderMyForm(name);

  // ì „ì²´ í˜„í™© í…Œì´ë¸”
  document.getElementById('peopleTableBody').innerHTML = MOCK_PEOPLE.map(p => {
    const restCells = RESTAURANTS.map(r =>
      p.votes.includes(r) ? '<td><span class="check-mark">âœ“</span></td>' : '<td></td>'
    ).join('');
    const optCell = p.optOut ? '<td><span class="opt-out-mark">X</span></td>' : '<td></td>';
    const menuText = [
      p.menu.name,
      p.menu.price !== null ? p.menu.price.toLocaleString('ko-KR') + 'ì›' : '',
      p.menu.note
    ].filter(Boolean).join(' Â· ');
    return `
      <tr>
        <td style="color:${p.hasVoted ? '#1a1a2e' : '#aaa'}">${p.name}</td>
        ${restCells}${optCell}
        <td style="text-align:left; font-size:0.82rem; color:#555;">${menuText}</td>
      </tr>`;
  }).join('');
}

function onPersonChange() {
  const name = document.getElementById('personSelect').value;
  const form = document.getElementById('voteForm');
  if (!name) { form.style.display = 'none'; return; }

  const person = MOCK_PEOPLE.find(p => p.name === name);
  myVotes  = person ? [...person.votes] : [];
  myOptOut = person ? person.optOut : false;
  form.style.display = '';
  renderMyForm(name);
}

function renderMyForm(name) {
  const cfg    = PHASE_CONFIG[currentPhase];
  const person = MOCK_PEOPLE.find(p => p.name === name);

  // ì‹ë‹¹ ê·¸ë¦¬ë“œ
  document.getElementById('restaurantGrid').innerHTML = RESTAURANTS.map(r => {
    const checked = myVotes.includes(r);
    return `
      <label class="rest-chip${checked ? ' checked' : ''}${cfg.voteDisabled ? ' disabled' : ''}"
        onclick="${cfg.voteDisabled ? '' : `toggleRest('${r}')`}">
        <div class="chip-check">${checked ? 'âœ“' : ''}</div>
        <span>${r}</span>
      </label>`;
  }).join('');

  // ì‹ì‚¬X
  const ob = document.getElementById('optOutBtn');
  const oc = document.getElementById('optOutChipCheck');
  ob.classList.toggle('checked', myOptOut);
  oc.textContent = myOptOut ? 'âœ“' : 'âœ—';
  ob.style.pointerEvents = cfg.voteDisabled ? 'none' : '';
  ob.style.opacity = cfg.voteDisabled ? '0.45' : '';

  // ë²„íŠ¼
  document.getElementById('saveVoteBtn').disabled = cfg.voteDisabled;
  document.getElementById('saveMenuBtn').disabled = cfg.menuDisabled || myOptOut;

  // ë©”ë‰´ í•„ë“œ
  const mn = document.getElementById('menuName');
  const mp = document.getElementById('menuPrice');
  const mnot = document.getElementById('menuNote');
  const menuDisabled = cfg.menuDisabled || myOptOut;
  [mn, mp, mnot].forEach(el => { el.disabled = menuDisabled; });

  if (person) {
    mn.value   = person.menu.name  || '';
    mp.value   = person.menu.price !== null ? person.menu.price : '';
    mnot.value = person.menu.note  || '';
  }
  mn.placeholder = myOptOut ? 'ì‹ì‚¬X ì„ íƒ ì‹œ ì…ë ¥ ë¶ˆê°€' : 'ë©”ë‰´ëª… (ì˜ˆ: ê¹€ì¹˜ì°Œê°œ)';
}

function toggleRest(r) {
  if (myOptOut) return;
  if (myVotes.includes(r)) {
    myVotes = myVotes.filter(v => v !== r);
  } else {
    if (myVotes.length >= 3) { showToast('ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error'); return; }
    myVotes.push(r);
  }
  renderMyForm(document.getElementById('personSelect').value);
}

function toggleOptOut() {
  if (PHASE_CONFIG[currentPhase].voteDisabled) return;
  myOptOut = !myOptOut;
  if (myOptOut) myVotes = [];
  renderMyForm(document.getElementById('personSelect').value);
}

function fakeAction(msg) {
  showToast(msg, 'success');
}

function showToast(msg, type) {
  const el = document.createElement('div');
  el.className = `toast ${type || 'info'}`;
  el.textContent = msg;
  document.getElementById('toastContainer').appendChild(el);
  setTimeout(() => el.remove(), 3200);
}
</script>
</body>
</html>
